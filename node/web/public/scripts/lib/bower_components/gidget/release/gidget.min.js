/*! gidget-builder 2015-11-13 */
Hilary.scope("gidget").register({name:"IGidget",dependencies:["Blueprint"],factory:function(a){"use strict";return new a({__blueprintId:"IGidget",GidgetModule:"function",GidgetRoute:{type:"function",args:["route"]},Bootstrapper:{type:"function",args:["scope","bootstrapper"]}})}}),Hilary.scope("gidget").register({name:"IGidgetApp",dependencies:["Blueprint"],factory:function(a){"use strict";return new a({__blueprintId:"IGidgetApp",start:"function",routeEngine:"object",pipeline:"object",PipelineEvent:{type:"function",args:["event"]},registerModule:{type:"function",args:["gidgetModule"]},registerModules:{type:"function",args:["gidgetModules"]}})}}),Hilary.scope("gidget").register({name:"IGidgetModule",dependencies:["Blueprint"],factory:function(a){"use strict";return new a({__blueprintId:"IGidgetModule",get:"object",post:"object",put:"object",del:"object",register:{type:"blueprint",blueprint:new a({__blueprintId:"IGidgetModule.register",get:{type:"function",args:["routePath","routeHandler"]},post:{type:"function",args:["routePath","routeHandler"]},put:{type:"function",args:["routePath","routeHandler"]},patch:{type:"function",args:["routePath","routeHandler"]},del:{type:"function",args:["routePath","routeHandler"]}})}})}}),Hilary.scope("gidget").register({name:"IGidgetRoute",dependencies:["Blueprint"],factory:function(a){"use strict";return new a({__blueprintId:"IGidgetRoute",routeHandler:"function"})}}),Hilary.scope("gidget").register({name:"IRouteEngine",dependencies:["Blueprint"],factory:function(a){"use strict";return new a({__blueprintId:"IRouteEngine",get:{type:"function",args:["path","callback"]},post:{type:"function",args:["path","payload","callback"]},put:{type:"function",args:["path","payload","callback"]},patch:{type:"function",args:["path","payload","callback"]},del:{type:"function",args:["path","callback"]},navigate:{type:"function",args:["pathOrOptions","data","pushStateToHistory"]},updateHistory:{type:"function",args:["path","data"]},register:{type:"blueprint",blueprint:new a({__blueprintId:"IRouteEngine.register",get:{type:"function",args:["path","callback"]},post:{type:"function",args:["path","callback"]},put:{type:"function",args:["path","callback"]},patch:{type:"function",args:["path","callback"]},del:{type:"function",args:["path","callback"]}})},resolveRoute:{type:"function",args:["path","verb","payload"]},resolveAndExecuteRoute:{type:"function",args:["path","verb","callback","payload"]},start:"function",dispose:"function",pipeline:"object"})}}),Hilary.scope("gidget").register({name:"locale",factory:{errors:{defaultMessage:"Gidget Error - see err.data",requiresArguments:"The {func} function requires arguments {args}",pipelineRequiresCallback:"A callback function is required to register a pipeline event",parseUriRequiresUriString:"A uriString is required to parse a URI",pipelineEventRequiresHandler:"PipelineEvent eventHandler is missing. Did you register an empty PipelineEvent?",status404:"Not Found!",interfaces:{requiresImplementation:"A valid implementation is required to create a new instance of an interface",requiresProperty:"The implementation is missing a required property: ",requiresArguments:"The implementation of this function requires the arguments: ",notAnIRouteEngine:"The router instance that was passed into the RouteEngine constructor does not implement IRouteEngine",notAnIGidgetApp:"The gidgetApp instance that were passed into the GidgetApp constructor does not implement IGidgetApp",notAnIGidgetModule:"The module that you are trying to register does not implement IGidgetModule",missingOptions:"To create a Gidget instance, you must provide the minimum required options"}}}}),Hilary.scope("gidget").register({name:"argumentValidator",dependencies:["locale","exceptions"],factory:function(a,b){"use strict";return{validate:function(a,c){var d,e=a.syncSignatureMatches(c);if(e.result)return!0;for(d=0;d<e.errors.length;d+=1)b.throwArgumentException(e.errors[d]);return e}}}}),Hilary.scope("gidget").register({name:"ExceptionHandler",dependencies:[],factory:function(a){"use strict";var b,c={makeException:void 0,argumentException:void 0,throwArgumentException:void 0,notImplementedException:void 0,throwNotImplementedException:void 0,fetchException:void 0,throwFetchException:void 0,throwException:void 0,"throw":void 0};return a="function"==typeof a?a:function(a){throw console.error(a),a},b=function(a,b,c){var d,e;return"object"==typeof a&&"string"==typeof a.message?(d=a.message,e=a):(d="string"==typeof b?b:a,e=new Error(d)),e.message=d,a!==d&&(e.name=a),c&&(e.data=c),e},c.makeException=b,c.argumentException=function(a,c,d){var e="undefined"==typeof c?a:a+" (argument: "+c+")";return b("ArgumentException",e,d)},c.throwArgumentException=function(a,b,d){c["throw"](c.argumentException(a,b,d))},c.notImplementedException=function(a,c){return b("NotImplementedException",a,c)},c.throwNotImplementedException=function(a,b){c["throw"](c.notImplementedException(a,b))},c.fetchException=function(a){return a=a||{},a.status=a.status||"unknown",b("FetchException","Server Request Failed with status: "+a.status,a)},c.throwFetchException=function(a){throw c["throw"](c.fetchException(a)),new Error("Server Request Failed with status: "+a.status)},c.throwException=function(a){c["throw"](a)},c["throw"]=function(c){a("string"==typeof c?b(c):c)},c}}),Hilary.scope("gidget").register({name:"GidgetApp",dependencies:["IGidgetModule","GidgetPipelineEvent","argumentValidator","is"],factory:function(a,b,c,d){"use strict";var e=function(e){var f={start:void 0,pipelines:{},registerModule:void 0,registerModules:void 0};return f.start=e.start,f.routeEngine=e,f.pipeline=e.pipeline,f.PipelineEvent=new b(f.pipeline),f.registerModule=function(b){if(c.validate(a,b)){var d,f,g,h,i,j=b.get,k=b.put,l=b.patch,m=b.post,n=b.del;for(d in j)j.hasOwnProperty(d)&&e.register.get(d,j[d]);for(f in k)k.hasOwnProperty(f)&&e.register.put(f,k[f]);for(g in l)l.hasOwnProperty(g)&&e.register.patch(g,l[g]);for(h in m)m.hasOwnProperty(h)&&e.register.post(h,m[h]);for(i in n)n.hasOwnProperty(i)&&e.register.del(i,n[i])}},f.registerModules=function(a){if(d.array(a)){var b;for(b=0;b<a.length;b+=1)f.registerModule(a[b])}},f};return e}}),Hilary.scope("gidget").register({name:"GidgetModule",dependencies:[],factory:function(){"use strict";return function(){var a={get:{},post:{},put:{},patch:{},del:{},register:{get:void 0,post:void 0,put:void 0,del:void 0}};return a.register.get=function(b,c){a.get[b]=c},a.register.post=function(b,c){a.post[b]=c},a.register.put=function(b,c){a.put[b]=c},a.register.patch=function(b,c){a.patch[b]=c},a.register.del=function(b,c){a.del[b]=c},a}}}),Hilary.scope("gidget").register({name:"GidgetPipeline",dependencies:["is","locale","exceptions"],factory:function(a,b,c){"use strict";var d=function(){var d,e,f,g;return d={before:{routeResolution:void 0,routeExecution:void 0},after:{routeResolution:void 0,routeExecution:void 0},on:{error:void 0,scrollToHash:void 0},trigger:{before:{routeResolution:void 0,routeExecution:void 0},after:{routeResolution:void 0,routeExecution:void 0},on:{error:void 0}}},e={beforeRouteResolution:[],afterRouteResolution:[],before:[],after:[],error:[],scrollToHash:void 0},e.scrollToHash=function(a,b){var c;b.uri.hash&&(c=document.getElementById(b.uri.hash),c&&c.scrollIntoView&&c.scrollIntoView({behavior:"smooth"}))},g=function(c){return a.not["function"](c)?(d.trigger.on.error({status:500,message:b.errors.pipelineRequiresCallback}),!1):!0},f=function(b,c){var d,e,f,g=[];for(e=function(c,d,e){var g=b[c];a["function"](g)&&3===g.length?g(d,e,f(c+1)):a["function"](g)&&(g(d,e),f(c+1)(d,e)),g.once?b.splice(c,1):a["function"](g.remove)&&g.remove(d,e)&&b.splice(c,1)},f=function(d){return function(g,h){b.length===d?a["function"](c)&&c(g,h):a["function"](b[d])?e(d,g,h):f(d+1)}},d=0;d<b.length;d+=1)g.push(f(d));return g},d.trigger.before.routeExecution=function(a,b,c){var d=f(e.before,c);d.length?d[0](a,b,c):c(a,b)},d.trigger.after.routeExecution=function(a,b){var c;e.scrollToHash(a,b),c=f(e.after),c.length&&c[0](a,b)},d.trigger.on.error=function(d){var f,g;for(f=a.object(d)&&d.stack?d:a.object(d)?c.makeException(d.name,d.message||b.errors.defaultMessage,d):a.string(d)?c.makeException(d):d,g=0;g<e.error.length;g+=1)e.error[g](f)},d.trigger.before.routeResolution=function(a,b){var c=f(e.beforeRouteResolution,b);c.length?c[0](null,a,b):b(null,a)},d.trigger.after.routeResolution=function(a,b,c){var d=f(e.afterRouteResolution,c);d.length?d[0](a,b,c):c(a,b)},d.before.routeResolution=function(a){var b;g(a)&&(a.length<3?(b=function(b,c,d){a(null,c),d(null,c)},b.once=a.once,b.remove=a.remove,e.beforeRouteResolution.push(b)):e.beforeRouteResolution.push(a))},d.after.routeResolution=function(a){var b;g(a)&&(a.length<3?(b=function(b,c,d){a(b,c),d(null,c)},b.once=a.once,b.remove=a.remove,e.afterRouteResolution.push(b)):e.afterRouteResolution.push(a))},d.before.routeExecution=function(a){var b;g(a)&&(a.length<3?(b=function(b,c,d){a(b,c),d(null,c)},b.once=a.once,b.remove=a.remove,e.before.push(b)):e.before.push(a))},d.after.routeExecution=function(a){g(a)&&e.after.push(a)},d.on.error=function(a){g(a)&&e.error.push(a)},d.on.scrollToHash=function(a){g(a)&&(e.scrollToHash=a)},d};return d}}),Hilary.scope("gidget").register({name:"GidgetPipelineEvent",dependencies:["is","locale"],factory:function(a,b){"use strict";var c,d;return c=function(c){var e;return c=c||{},e=a.not["function"](c.eventHandler)?function(){d.trigger.on.error({status:500,message:b.errors.pipelineEventRequiresHandler})}:c.eventHandler,a["boolean"](c.once)&&(e.once=c.once),a["function"](c.remove)&&(e.remove=c.remove),e},function(a){return d=a,c}}}),Hilary.scope("gidget").register({name:"GidgetRequest",dependencies:["is"],factory:function(a){"use strict";return function(b){var c,d=this;c=a.string(b)?{}:b||{},d.uri=b.uri,d.route=b.route,d.params=b.params,d.callback=b.callback,d.payload=b.payload}}}),Hilary.scope("gidget").register({name:"GidgetRoute",dependencies:["IGidgetRoute","argumentValidator"],factory:function(a,b){"use strict";return function(c){if(b.validate(a,c)){var d=c.routeHandler;return"function"==typeof c.before&&(d.before=c.before),"function"==typeof c.after&&(d.after=c.after),d}}}}),Hilary.scope("gidget").register({name:"BaseRouteEngine",dependencies:["Route","GidgetRequest","GidgetPipeline","is","uriHelper","locale","exceptions"],factory:function(a,b,c,d,e,f,g){"use strict";var h=function(h){var i,j,k,l,m,n,o,p,q,r=new c,s=[];return h=h||{},i={get:h.get,post:h.post,put:h.put,patch:h.patch,del:h.del,navigate:h.navigate,scrollToHash:h.scrollToHash,register:{get:void 0,post:void 0,put:void 0,patch:void 0,del:void 0},parseRoute:void 0,resolveRoute:void 0,resolveAndExecuteRoute:void 0,start:h.start,pipeline:r},j={escapeRegExp:/[-[\]{}()+?.,\\^$|#\s]/g,namedParam:/:(\w+)/g,splatParam:/\*(\w+)/g,firstParam:/(:\w+)|(\*\w+)/,allParams:/(:|\*)\w+/g,extractHash:/^[^#]*(#.*)$/},k=function(a){if(d["function"](a)&&a.length<3){var b=function(b,c,d){a(b,c),d(b,c)};return b.before=k(a.before),b.after=k(a.after),b}return a},l=function(a){return function(b,c){var e,f,g,h,i;e=function(){d["function"](a.before)?a.before(null,c,f):f(null,c)},f=function(a,b){r.trigger.before.routeExecution(a,b,g)},g=function(b,c){a(b,c,h)},h=function(b,c){d["function"](a.after)?a.after(b,c,i):i(b,c)},i=function(a,b){r.trigger.after.routeExecution(a,b)},e()}},m=function(a,b,c){(d.not.defined(b)||d.not["function"](c))&&g.throwArgumentException(f.errors.requiresArguments.replace("{func}","addRoute").replace("{args}","(verb, path, callback)")),s.push({route:o(a,b),callback:l(k(c))})},n=function(a){if(null!==a){var b,c=[];for(b=0;b<a.length;b+=1)c.push(a[b].substr(1));return c}return[]},o=function(b,c,d){var e,f;return f=String(c),e=n(f.match(j.allParams)),f=f.replace(j.escapeRegExp,"\\$&"),f=f.replace(j.namedParam,"([^/]+)"),f=f.replace(j.splatParam,"(.+?)"),new a({expressionString:f,paramNames:e,verb:b,source:c},d)},p=function(a,b){var c,e,f={};if(c=a.match(b.expression),d.not.array(c)||1===c.length)return f.splat=[],f;for(c.shift(),f.splat=c,e=0;e<b.paramNames.length;e+=1)f[b.paramNames[e]]=f.splat[e];return f},q=function(a){d.not["function"](a)&&g.throwArgumentException(f.errors.requiresArguments.replace("{func}","runAsync").replace("{args}","(handler)")),setTimeout(a,0)},i.register.get=function(a,b){return m("get",a,b)},i.register.post=function(a,b){return m("post",a,b)},i.register.put=function(a,b){return m("put",a,b)},i.register.patch=function(a,b){return m("patch",a,b)},i.register.del=function(a,b){return m("del",a,b)},i.resolveRoute=function(a,c,d){var f,g,h=e.parseUri(a);for(f=function(a,c){return new b({route:c.route,params:p(a.path,c.route),uri:a,callback:c.callback,payload:d})},g=0;g<s.length;g+=1)if(s[g].route.expression.test(h.path)){if(!c)return f(h,s[g]);if(s[g].route.verb===c)return f(h,s[g])}return!1},i.resolveAndExecuteRoute=function(a,c,g,h){var j,k,l,m,n=e.parseUri(a);j=function(){r.trigger.before.routeResolution(new b({uri:n}),k)},k=function(a,b){return a?void r.trigger.on.error(a):(m=i.resolveRoute(b.uri,c,h),void(m===!1?(a={status:404,message:f.errors.status404,uri:n},r.trigger.on.error(a)):d["function"](m.callback)&&l(m)))},l=function(a){r.trigger.after.routeResolution(null,a,a.callback),d["function"](g)&&g(null,a,h)},j()},i.get=function(a,b){q(function(){i.resolveAndExecuteRoute(a,"get",b)})},i.post=function(a,b,c){q(function(){i.resolveAndExecuteRoute(a,"post",c,b)})},i.put=function(a,b,c){q(function(){i.resolveAndExecuteRoute(a,"put",c,b)})},i.patch=function(a,b,c){q(function(){i.resolveAndExecuteRoute(a,"patch",c,b)})},i.del=function(a,b){q(function(){i.resolveAndExecuteRoute(a,"del",b)})},i};return h}}),function(a,b){"use strict";a.scope("gidget").register({name:"DefaultRouteEngine",dependencies:["BaseRouteEngine","is","uriHelper"],factory:function(a,c,d){var e,f,g,h,i,j,k;return function(){e=function(){g(),f()},f=function(){j.navigate(location.href)},h=function(a){var b;b=c.string(a.target.localName)&&"a"===a.target.localName&&(0===a.target.target.length||"_self"===a.target.target)&&a.target.href.length>0&&!(a.target.href.indexOf("javascript:")>-1&&a.target.href.indexOf("void(")>-1),b&&(a.preventDefault(),j.navigate(a.target.href))},i=function(a){c.string(a.state)?(a.preventDefault(),j.navigate(a.state,null,!1)):c.object(a.state)&&c.object(a.state.uri)&&c.defined(a.state.uri.path)&&(a.preventDefault(),j.navigate(null,a.state,!1))},g=function(){document.addEventListener("click",h,!1),window.addEventListener("popstate",i,!1)}}(),function(){var f,g;f=function(a,b,d){var e={};return c.string(a)?(e.path=a,e.data=b,e.pushStateToHistory=d):(e=a,e.data=e.data||b,e.pushStateToHistory=c.defined(e.pushStateToHistory)?e.pushStateToHistory:d),e.pushStateToHistory=e.pushStateToHistory||c.not.defined(e.pushStateToHistory),e},g=function(a,b){var c,e=b||{};return e.uri=e.uri||d.parseUri(a),k=k||document.title,e.title=e.title||k,c=!e.uri.host||e.uri.host===document.location.host,c||(e.redirect=!0),e},j=new a({start:e}),j.navigate=function(a,d,e){var h=f(a,d,e),i=g(h.path,h.data);return i.redirect?void(window.location=h.path):void j.get(i.uri,function(a,d){var e=d.title||i.title||"home";i.title=e,h.pushStateToHistory?(b.pushState(i,e,i.uri.relativePath),document.title=e):document.title=e,c["function"](h.callback)&&h.callback(d)})},j.redirect=j.navigate,j.updateHistory=function(a,c){var d=g(a,c),e=d.title||"home";d.title=e,b.replaceState(d,e,d.uri.relativePath),document.title=e},j.dispose=function(){document.removeEventListener("click",h,!1),window.removeEventListener("popstate",i,!1)}}(),j}})}(Hilary,window.history),Hilary.scope("gidget").register({name:"DefaultGidgetBootstrapper",dependencies:["is"],factory:function(a){"use strict";var b=function(b,c){var d,e,f,g,h,i;b=b||new Hilary,c=c||{},c.options=c.options||{},c.hilary=c.hilary||{},i=function(a){console.log(a)},d=function(){a["function"](c.start)?c.start(null,e):e(null,new Gidget(c.options))},e=function(b,d){b&&i(b),a["function"](c.composeLifecycle)&&4===c.composeLifecycle.length?c.composeLifecycle(b,d,d.pipeline,f):a["function"](c.composeLifecycle)?(c.composeLifecycle(b,d,d.pipeline),f(b,d)):f(b,d)},f=function(e,f){e&&i(e),b.register({name:"gidgetApp",factory:function(){return f}}),b.register({name:"gidgetRouter",factory:function(){return f.routeEngine}}),b.register({name:"application",factory:function(){return{restart:function(){d()}}}}),a["function"](c.composeModules)&&3===c.composeModules.length?c.composeModules(e,f,g):a["function"](c.composeModules)?(c.composeModules(e,f),g(e,f)):g(e,f)},g=function(b,d){b&&i(b),a["function"](c.composeRoutes)&&3===c.composeRoutes.length?c.composeRoutes(b,d,h):a["function"](c.composeRoutes)?(c.composeRoutes(b,d),h(b,d)):h(b,d)},h=function(d,e){var f;d&&i(b,d),f=function(){e.routeEngine.start()},a["function"](c.onComposed)&&3===c.onComposed.length?c.onComposed(d,e,f):a["function"](c.onComposed)?(c.onComposed(d,e),f()):f()},c.options.composeHilary!==!1?b.Bootstrapper({composeLifecycle:c.hilary.composeLifecycle,composeModules:c.hilary.composeModules,onComposed:function(b,e){a["function"](c.hilary.onComposed)&&c.hilary.onComposed(b,e),d()}}):d()};return b}}),Hilary.scope("gidget").register({name:"Route",factory:function(){"use strict";return function(a,b){var c=this,d=b?"":"i";a=a||{},c.expression=new RegExp("^"+a.expressionString+"/?$",d),c.expressionString=a.expressionString,c.paramNames=a.paramNames,c.source=String(a.source),c.verb=a.verb}}}),Hilary.scope("gidget").register({name:"uriHelper",singleton:!0,dependencies:["is","locale","exceptions"],factory:function(a,b,c){"use strict";var d={parseUri:void 0},e=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,f=["source","protocol","authority","userAndPassword","user","password","hostName","port","relativePath","path","directory","file","queryString","hash"],g={name:"query",parser:/(?:^|&)([^&=]*)=?([^&]*)/g};return d.parseUri=function(d){if(a.not.defined(d))c.throwArgumentException(b.errors.parseUriRequiresUriString,"uriString");else{if(a.not.string(d)&&d.path)return d;a.not.string(d)&&c.throwArgumentException(b.errors.parseUriRequiresUriString,"uriString")}var h,i=d,j=d.indexOf("["),k=d.indexOf("]"),l={},m=14;for(-1!==j&&-1!==k&&(d=d.substring(0,j)+d.substring(j,k).replace(/:/g,";")+d.substring(k,d.length)),h=e.exec(d||"");m--;)l[f[m]]=h[m]||void 0;return-1!==j&&-1!==k&&(l.source=i,l.host=l.host.substring(1,l.host.length-1).replace(/;/g,":"),l.authority=l.authority.replace("[","").replace("]","").replace(/;/g,":"),l.ipv6uri=!0),l.port=l.port&&parseInt(l.port),a.string(l.queryString)&&(l[g.name]={},l.queryString.replace(g.parser,function(a,b,c){b&&(l[g.name][b]=c)})),l.host=l.hostName&&l.port?l.hostName.concat(":",l.port):l.hostName,l.origin=l.authority&&l.protocol.concat("://",l.authority.replace(l.userAndPassword,"").replace("@","")),l},d}}),function(a,b,c){"use strict";b.Bootstrapper({composeLifecycle:function(a,b,c){c.on.error(function(a){try{b.resolve("exceptions")["throw"](a)}catch(c){console.log(c),console.log(a)}})},composeModules:function(b,c){var d;c.register({name:"Blueprint",singleton:!0,factory:function(){return a.Blueprint}}),c.register({name:"is",singleton:!0,factory:function(){return c.getContext().is}}),c.register({name:"exceptions",singleton:!0,dependencies:["ExceptionHandler"],factory:function(a){return d||(d=new a(function(a){throw a.data?console.log(a.message,a.data):console.log(a.message),a})),d}}),c.register({name:"Gidget",blueprint:"IGidget",dependencies:["IRouteEngine","GidgetModule","GidgetRoute","DefaultGidgetBootstrapper","GidgetApp","argumentValidator"],factory:function(a,b,d,e,f,g){var h=function(b){return b=b||{},b.routeEngine=b.routeEngine||c.resolve("DefaultRouteEngine"),g.validate(a,b.routeEngine)?new f(b.routeEngine):void 0};return h.GidgetModule=b,h.GidgetRoute=d,h.Bootstrapper=e,h}})},onComposed:function(a,b){var d=b.resolve("Gidget");c.Gidget=d}})}(Hilary,Hilary.scope("gidget"),"undefined"!=typeof module&&module.exports?module.exports:window);